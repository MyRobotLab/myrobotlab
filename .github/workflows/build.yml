name: Java CI

#on: [push]

on:
  push:
    branches:
      - develop

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      # - name: Set up JDK 11
      #   uses: actions/setup-java@v3

      #   with:
      #     java-version: '11'
      #     distribution: 'adopt'

      # - name: Dependency Test
      #   run: mvn test -Dtest=org.myrobotlab.framework.DependencyTest -q

      # - name: Build and Test with Maven
      #   run: mvn --batch-mode -Dtest=!**/OpenCV* test -q

      # - name: Package with Maven
      #   run: mvn package -DskipTests 

      - name: Fake Build
        run: |
          mkdir -p target
          echo ${{ github.sha }} > myrobotlab.zip

      - name: Get next version
        uses: reecetech/version-increment@2023.9.3
        id: version
        with:
          scheme: semver
          increment: patch      

      - name: Release
        uses: softprops/action-gh-release@v1
        with:
          token: ${{ secrets.ACCESS_TOKEN }}
          files: ./target/myrobotlab.zip
          tag_name: ${{ steps.version.outputs.version }}

      # - name: Create Release
      #   id: create_release
      #   uses: actions/create-release@v1
      #   env:
      #     # GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} default expires
      #     GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
      #   with:
      #     tag_name: ${{ steps.version.outputs.version }}
      #     release_name: Release ${{ steps.version.outputs.version }}
      #     draft: false
      #     prerelease: false  
          
      # - name: Upload Release Artifacts
      #   uses: actions/upload-release-asset@v1
      #   env:
      #     # GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} default expires
      #     GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
      #   with:
      #     upload_url: ${{ steps.create_release.outputs.upload_url }}
      #     asset_path: ./target/myrobotlab.zip
      #     asset_name: myrobotlab.zip
      #     asset_content_type: application/zip
